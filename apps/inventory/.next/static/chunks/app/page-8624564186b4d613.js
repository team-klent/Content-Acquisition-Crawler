(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{829:()=>{},2130:()=>{},4737:(e,a,r)=>{Promise.resolve().then(r.bind(r,8333))},5062:()=>{},7089:()=>{},8211:()=>{},8333:(e,a,r)=>{"use strict";r.d(a,{default:()=>C});var t=r(8861),s=r(564),l=r(3839),n=r(3705),o=r(9975),i=r(2171);let c={HEADER:"px-4 py-2 bg-gray-100 font-medium text-sm",CONTENT:"px-4 py-2 text-sm break-all pr-2"},d={PDF_VIEWER_MIN_HEIGHT:"600px",LOADING_TIMEOUT:2500},m={CONTAINER:"bg-red-50 border-l-4 border-red-500 p-4 mb-4",TITLE:"text-lg font-medium text-red-800 mb-2",MESSAGE:"text-sm text-red-700 mb-2",SUCCESS_INDICATOR:"absolute top-2 right-2 bg-green-100 text-green-800 px-3 py-1 rounded-full flex items-center z-10 shadow-sm",OVERLAY:"absolute inset-0 bg-white bg-opacity-95 flex items-center justify-center z-10 p-5"};function h(){for(var e=arguments.length,a=Array(e),r=0;r<e;r++)a[r]=arguments[r];return(0,i.QP)((0,o.$)(a))}let x=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-[#2B76E5] text-white font-[16.16px] shadow hover:bg-[#2B76E5]/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),u=n.forwardRef((e,a)=>{let{className:r,variant:l,size:n,asChild:o=!1,...i}=e,c=o?s.DX:"button";return(0,t.jsx)(c,{className:h(x({variant:l,size:n,className:r})),ref:a,...i})});function f(e){let{className:a,...r}=e;return(0,t.jsx)("div",{"data-slot":"card",className:h("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",a),...r})}function p(e){let{className:a,...r}=e;return(0,t.jsx)("div",{"data-slot":"card-header",className:h("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",a),...r})}function b(e){let{className:a,...r}=e;return(0,t.jsx)("div",{"data-slot":"card-title",className:h("leading-none font-semibold",a),...r})}function N(e){let{className:a,...r}=e;return(0,t.jsx)("div",{"data-slot":"card-description",className:h("text-muted-foreground text-sm",a),...r})}function j(e){let{className:a,...r}=e;return(0,t.jsx)("div",{"data-slot":"card-content",className:h("px-6",a),...r})}u.displayName="Button",n.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:a,className:h("w-full caption-bottom text-sm",r),...s})})}).displayName="Table",n.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("thead",{ref:a,className:h("[&_tr]:border-b",r),...s})}).displayName="TableHeader";let g=n.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("tbody",{ref:a,className:h("[&_tr:last-child]:border-0",r),...s})});g.displayName="TableBody",n.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("tfoot",{ref:a,className:h("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...s})}).displayName="TableFooter";let w=n.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("tr",{ref:a,className:h("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...s})});w.displayName="TableRow",n.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("th",{ref:a,className:h("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",r),...s})}).displayName="TableHead";let v=n.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("td",{ref:a,className:h("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",r),...s})});function E(e){let a=window.location.pathname.startsWith("/app1")?"/app1":"",r=e.startsWith("/")?e:"/".concat(e);return"".concat(a).concat(r)}function _(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{let r=E("/api/pdf-proxy"),t=Date.now(),s=Math.floor(1e6*Math.random()),l=new URLSearchParams;l.append("url",e),a%2==0?l.append("_cb","".concat(t,"_").concat(s)):(l.append("_t",t.toString()),l.append("_r",s.toString(36)));let n=["standard","web","cors","stream","xhr","direct"],o=n[a%n.length];switch(l.append("_mode",o),a%4){case 0:l.append("_xhr","true"),l.append("_accept","application/pdf");break;case 1:l.append("_agent","webapp"),l.append("_format","blob");break;case 2:l.append("_nav","direct"),l.append("_stream","true");break;case 3:l.append("_fmt","raw"),l.append("_inline","true")}l.append("_origin",window.location.hostname);let i=Array.from(l.entries());for(let e=i.length-1;e>0;e--){let a=Math.floor(Math.random()*(e+1));[i[e],i[a]]=[i[a],i[e]]}let c=i.map(e=>{let[a,r]=e;return"".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(r))}).join("&");return"".concat(r,"?").concat(c)}catch(r){let a=E("/api/pdf-proxy");return"".concat(a,"?url=").concat(encodeURIComponent(e),"&_cb=").concat(Date.now())}}v.displayName="TableCell",n.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("caption",{ref:a,className:h("mt-4 text-sm text-muted-foreground",r),...s})}).displayName="TableCaption";var y=r(9053);r(8863);var T=r(6896);r(9021);var k=r(5),D=r(8830),I=r(8919),A=r(5455);function R(e){let{pdfUrl:a,filename:r}=e,[s,l]=(0,n.useState)(Math.random()),[o,i]=(0,n.useState)(!0),[c,h]=(0,n.useState)(null),[x,f]=(0,n.useState)(!1);(0,n.useEffect)(()=>{i(!0),h(null),l(Math.random())},[a]);let p=_(a),b=(0,n.useRef)(null);return(0,n.useEffect)(()=>{let e=()=>{setTimeout(()=>{i(!1),f(!0)},0)},a=()=>{},r=b.current;if(r){r.addEventListener("load",e),r.addEventListener("error",a);let t=setTimeout(()=>{i(!1)},d.LOADING_TIMEOUT);return()=>{r.removeEventListener("load",e),r.removeEventListener("error",a),clearTimeout(t)}}},[p]),(0,t.jsxs)("div",{className:"h-full flex flex-col relative",style:{minHeight:d.PDF_VIEWER_MIN_HEIGHT},children:[o&&(0,t.jsx)("div",{className:"absolute inset-0 bg-white bg-opacity-80 flex items-center justify-center z-10",children:(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-700"}),(0,t.jsx)("p",{className:"mt-2",children:"Loading PDF..."})]})}),x&&!o&&!c&&(0,t.jsxs)("div",{className:m.SUCCESS_INDICATOR,children:[(0,t.jsx)(A.A,{className:"w-4 h-4 mr-1"}),(0,t.jsx)("span",{className:"text-xs font-medium",children:"PDF Loaded Successfully"})]}),c&&(0,t.jsx)("div",{className:m.OVERLAY,children:(0,t.jsx)("div",{className:m.CONTAINER.replace("mb-4","max-w-lg"),children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("h3",{className:m.TITLE,children:"Failed to load PDF"}),(0,t.jsx)("p",{className:m.MESSAGE.replace("mb-2","mb-4"),children:c}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"You can try the following options:"}),(0,t.jsxs)("div",{className:"flex flex-col space-y-2 sm:flex-row sm:space-y-0 sm:space-x-2",children:[(0,t.jsx)(u,{variant:"outline",onClick:()=>{i(!0),h(null),l(Math.random())},children:"Try Again"}),(0,t.jsxs)(u,{variant:"outline",onClick:()=>window.open(a,"_blank"),children:[(0,t.jsx)(D.A,{className:"mr-2 h-4 w-4"})," Download PDF"]})]})]})})}),(0,t.jsxs)("div",{className:"pdf-container",style:{height:"calc(100% - 20px)",minHeight:d.PDF_VIEWER_MIN_HEIGHT},children:[(0,t.jsx)("div",{className:"h-full",children:(0,t.jsx)("object",{ref:b,data:p,type:"application/pdf",width:"100%",height:d.PDF_VIEWER_MIN_HEIGHT,className:"border-2 border-gray-200",children:(0,t.jsxs)("p",{children:["Your browser does not support PDF embedding. ",(0,t.jsx)("a",{href:p,target:"_blank",rel:"noreferrer",children:"Click here to download the PDF"})]})})}),(0,t.jsx)("iframe",{style:{height:"100%",minHeight:d.PDF_VIEWER_MIN_HEIGHT,display:"none",backgroundColor:"#f0f0f0"},className:"w-full border-2 border-gray-200",src:p,title:"PDF Viewer - ".concat(r),onLoad:e=>{setTimeout(()=>{i(!1),f(!0)},0)},onError:e=>{setTimeout(()=>{h("Failed to load the PDF. Using object tag as fallback.")},0)},sandbox:"allow-scripts allow-same-origin allow-forms"},s)]})]})}function C(){let e=(0,I.useSearchParams)(),[a,r]=(0,n.useState)(null),[s,l]=(0,n.useState)(!0),[o,i]=(0,n.useState)(null),[h,x]=(0,n.useState)(!1),[A,C]=(0,n.useState)(!1),P=(0,T.defaultLayoutPlugin)();return((0,n.useEffect)(()=>{(async()=>{try{l(!0),i(null);let a=e.get("project_id"),t=e.get("job_id"),s=e.get("file_id"),n=e.get("task_id");if(!a||!t||!s||!n){i("Missing required URL parameters"),l(!1);return}let o=E("/api/inventory"),c="".concat(o,"?project_id=").concat(a,"&job_id=").concat(t,"&file_id=").concat(s,"&task_id=").concat(n),d=await fetch(c);if(!d.ok){let e=await d.text().catch(()=>"");if(404===d.status)throw Error("Resource not found (404). The API endpoint or requested file might not exist. Check the URL parameters and API route.");if(405===d.status)throw Error("Method Not Allowed (405). The API doesn't support the request method being used. ".concat(e));if(401===d.status)throw Error("Authentication Error (401). API token is missing or invalid. Please check your API_TOKEN environment variable. ".concat(e));else throw Error("API Error: ".concat(d.status,". ").concat(e))}let m=await d.json();if(!m.status||m.error)throw Error(m.error||"Unknown API error");let h=m.file;r(h)}catch(e){i(e instanceof Error?e.message:"Unknown error occurred")}finally{l(!1)}})()},[e]),s)?(0,t.jsx)("div",{className:"flex justify-center items-center min-h-[400px]",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-700"})}):o?(0,t.jsx)("div",{className:m.CONTAINER,children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("h3",{className:m.TITLE,children:"Error Loading File"}),(0,t.jsx)("p",{className:m.MESSAGE,children:o})]})}):a?(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"flex items-center mb-4",children:(0,t.jsx)("h2",{className:"ml-4 text-2xl font-medium",children:a.file_name})}),(0,t.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"col-span-3 h-[80vh] relative ",style:{minHeight:d.PDF_VIEWER_MIN_HEIGHT},children:[A?(0,t.jsx)(R,{pdfUrl:a.download_url,filename:a.file_name}):(0,t.jsx)(y.Worker,{workerUrl:"https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js",children:(0,t.jsx)(y.Viewer,{fileUrl:_(a.download_url),defaultScale:y.SpecialZoomLevel.PageFit,withCredentials:!1,plugins:[P],renderError:e=>(x(!0),(0,t.jsxs)("div",{className:"p-5 text-center",children:[(0,t.jsx)("p",{className:"text-red-500 font-semibold mb-2",children:"Failed to load the PDF document"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:e.message||"Unknown PDF loading error"}),(0,t.jsxs)("div",{className:"flex justify-center gap-3 mt-6",children:[(0,t.jsxs)(u,{variant:"outline",onClick:()=>C(!0),children:[(0,t.jsx)(k.A,{className:"mr-2 h-4 w-4"})," Try Direct Viewer"]}),(0,t.jsxs)(u,{variant:"outline",onClick:()=>window.open(a.download_url,"_blank"),children:[(0,t.jsx)(D.A,{className:"mr-2 h-4 w-4"})," Download PDF"]})]})]}))})}),h&&!A&&(0,t.jsx)("div",{className:"absolute bottom-4 right-4",children:(0,t.jsxs)(u,{variant:"secondary",size:"sm",onClick:()=>C(!0),children:[(0,t.jsx)(k.A,{className:"mr-2 h-4 w-4"})," Try Direct Viewer"]})}),A&&(0,t.jsx)("div",{className:"absolute bottom-4 right-4",children:(0,t.jsxs)(u,{variant:"secondary",size:"sm",onClick:()=>C(!1),children:[(0,t.jsx)(k.A,{className:"mr-2 h-4 w-4"})," Try PDF.js Viewer"]})})]}),(0,t.jsx)("div",{className:"col-span-1",children:(0,t.jsxs)(f,{children:[(0,t.jsxs)(p,{children:[(0,t.jsx)(b,{className:"flex items-center gap-2  font-medium",children:"Basic Information"}),(0,t.jsx)(N,{children:"Details about this document"})]}),(0,t.jsxs)(j,{className:"space-y-4 flex flex-col justify-between",children:[(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsx)("div",{children:(0,t.jsx)("div",{className:"border rounded-md overflow-hidden",children:(0,t.jsx)("table",{className:"w-full overflow-hidden",children:(0,t.jsxs)(g,{children:[(0,t.jsxs)(w,{className:"border-b",children:[(0,t.jsx)(v,{className:c.HEADER,children:"File Name:"}),(0,t.jsx)(v,{className:c.CONTENT,children:a.file_name})]}),(0,t.jsxs)(w,{className:"border-b",children:[(0,t.jsx)(v,{className:c.HEADER,children:"Project:"}),(0,t.jsxs)(v,{className:c.CONTENT,children:[a.project_code," ",a.project_name&&"(".concat(a.project_name,")")]})]}),(0,t.jsxs)(w,{className:"border-b",children:[(0,t.jsx)(v,{className:c.HEADER,children:"Job:"}),(0,t.jsx)(v,{className:c.CONTENT,children:a.job_name})]}),(0,t.jsxs)(w,{className:"border-b",children:[(0,t.jsx)(v,{className:c.HEADER,children:"Batch:"}),(0,t.jsx)(v,{className:c.CONTENT,children:a.batch_name})]}),(0,t.jsxs)(w,{className:"border-b",children:[(0,t.jsx)(v,{className:c.HEADER,children:"Task:"}),(0,t.jsx)(v,{className:c.CONTENT,children:a.task_name})]}),(0,t.jsxs)(w,{className:"border-b",children:[(0,t.jsx)(v,{className:c.HEADER,children:"Created:"}),(0,t.jsx)(v,{className:c.CONTENT,children:new Date(a.created_at).toLocaleString()})]}),(0,t.jsxs)(w,{className:"border-b",children:[(0,t.jsx)(v,{className:c.HEADER,children:"Updated:"}),(0,t.jsx)(v,{className:c.CONTENT,children:new Date(a.updated_at).toLocaleString()})]}),(0,t.jsxs)(w,{children:[(0,t.jsx)(v,{className:c.HEADER,children:"File Status:"}),(0,t.jsx)(v,{className:c.CONTENT,children:a.current_file_status||"Unknown"})]})]})})})})}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsxs)(u,{variant:"ghost",className:"relative cursor-pointer shadow-md ring-1 ring-gray-200 hover:bg-gray-100 w-full",onClick:()=>window.open(a.download_url,"_blank"),children:[(0,t.jsx)(D.A,{className:"mr-2"})," Download PDF"]})})]})]})})]})]}):(0,t.jsx)("div",{className:"text-center py-10",children:(0,t.jsx)("p",{className:"text-gray-500",children:"No file data available"})})}}},e=>{var a=a=>e(e.s=a);e.O(0,[883,609,127,780,806,358],()=>a(4737)),_N_E=e.O()}]);