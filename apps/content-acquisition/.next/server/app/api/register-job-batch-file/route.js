(()=>{var e={};e.id=839,e.ids=[839],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},975:(e,t,r)=>{"use strict";r.d(t,{vP:()=>s,yJ:()=>i});let i={M1:"V1",M2:"V2"},s={UNIQUE_ID_PREFIX:"file-uid-",DEFAULT_FILE_PATH:"-"}},2275:(e,t,r)=>{"use strict";r.d(t,{O:()=>n,cn:()=>o});var i=r(6377),s=r(7273),a=r(975);function o(...e){return(0,s.QP)((0,i.$)(e))}function n(e){return`${a.vP.UNIQUE_ID_PREFIX}${e}-${Date.now()}`}},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3279:(e,t,r)=>{"use strict";r.d(t,{Kv:()=>o,S8:()=>u});var i=r(975),s=r(2275);async function a(e){let t=process.env.NEXT_PUBLIC_IA_API_URL,r=`${t}/api/register-job-batch-file`;try{e.file_path||(e.file_path=i.vP.DEFAULT_FILE_PATH),e.file_unique_identifier||(e.file_unique_identifier=(0,s.O)(e.file_name));let t={...e,project_id:e.project_id||"",workflow_id:e.workflow_id||""},a=await fetch(r,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${process.env.API_TOKEN}`},body:JSON.stringify(t)});if(!a.ok){let e=a.headers.get("content-type"),t="";try{if(e&&e.includes("application/json")){let e=await a.json();t=JSON.stringify(e)}else t=await a.text()}catch(e){t="Could not parse error response"}throw Error(`Failed to register job batch file: ${a.status} ${a.statusText} - ${t}`)}let o=a.headers.get("content-type");if(!o||!o.includes("application/json")){let e=await a.text();throw Error(`Expected JSON response but received: ${e.substring(0,100)}...`)}return await a.json()}catch(e){throw e}}async function o(e,t,r){try{let i,s=await a(e);if("string"!=typeof s.file_output_path)throw Error("file_output_path is not a valid string");let o=await n(t,s.file_output_upload_url);if(o.success&&s.file_id){let t=r?.previousFileStatus||"I",a=r?.fileStatus||"C";try{i=await u({project_code:e.project_code,task_uid:e.first_task_uid,file_id:s.file_id,previous_file_status:t,file_status:a})}catch{}}return{registration:s,upload:o,statusUpdate:i}}catch(e){throw e}}async function n(e,t){try{let i=await Promise.resolve().then(r.t.bind(r,9021,23));if(!i.existsSync(e))throw Error(`File not found at path: ${e}`);let s=i.readFileSync(e),a=await fetch(t,{method:"PUT",body:s});if(!a.ok)throw Error(`Failed to upload file: ${a.status} ${a.statusText}`);return{success:!0,message:"File uploaded successfully"}}catch(e){return{success:!1,message:e instanceof Error?e.message:"Unknown error occurred during file upload"}}}async function u(e){let t=process.env.NEXT_PUBLIC_IA_API_URL,r=`${t}/api/update-file-status`;try{let t=["project_code","task_uid","file_id","previous_file_status","file_status"].filter(t=>!e[t]||"string"==typeof e[t]&&""===e[t].trim());if(t.length>0)throw Error(`Missing required fields: ${t.join(", ")}`);let i=await fetch(r,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${process.env.API_TOKEN}`},body:JSON.stringify(e)});if(!i.ok){let e=i.headers.get("content-type"),t="";try{if(e&&e.includes("application/json")){let e=await i.json();t=JSON.stringify(e)}else t=await i.text()}catch(e){t=`${e} Could not parse error response`}throw Error(`Failed to update file status: ${i.status} ${i.statusText} - ${t}`)}return await i.json()}catch(e){throw e}}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},4394:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>P,routeModule:()=>U,serverHooks:()=>E,workAsyncStorage:()=>b,workUnitAsyncStorage:()=>k});var i={};r.r(i),r.d(i,{POST:()=>x});var s=r(9837),a=r(6890),o=r(5513),n=r(3279),u=r(975),l=r(2275),c=r(9021);let p=require("fs/promises");var d=r(1516);let f=require("os");var _=r.n(f),h=r(3873);let g=require("crypto"),w={randomUUID:g.randomUUID},m=new Uint8Array(256),y=m.length,j=[];for(let e=0;e<256;++e)j.push((e+256).toString(16).slice(1));let v=function(e,t,r){if(w.randomUUID&&!t&&!e)return w.randomUUID();let i=(e=e||{}).random??e.rng?.()??(y>m.length-16&&((0,g.randomFillSync)(m),y=0),m.slice(y,y+=16));if(i.length<16)throw Error("Random bytes length must be >= 16");if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=i[e];return t}return function(e,t=0){return(j[e[t+0]]+j[e[t+1]]+j[e[t+2]]+j[e[t+3]]+"-"+j[e[t+4]]+j[e[t+5]]+"-"+j[e[t+6]]+j[e[t+7]]+"-"+j[e[t+8]]+j[e[t+9]]+"-"+j[e[t+10]]+j[e[t+11]]+j[e[t+12]]+j[e[t+13]]+j[e[t+14]]+j[e[t+15]]).toLowerCase()}(i)};async function x(e){try{let t,r=h.join(_().tmpdir(),"content-acquisition-uploads");c.existsSync(r)||c.mkdirSync(r,{recursive:!0});let i=e.headers.get("content-type")||"",s=null;if(i.includes("multipart/form-data")){let i=await e.formData(),a=i.get("file");if(!a)return d.NextResponse.json({error:"No file uploaded"},{status:400});let o=i.get("project_id"),n=i.get("workflow_id");t={project_code:i.get("project_code"),workflow_code:i.get("workflow_code"),first_task_uid:i.get("first_task_uid"),file_unique_identifier:i.get("file_unique_identifier")||"",file_name:a.name,file_path:"",project_id:o?String(o):"",workflow_id:n?String(n):"",meta_data:JSON.parse(i.get("meta_data")||"{}")};let u=v();s=h.join(r,`${u}-${a.name}`);let l=Buffer.from(await a.arrayBuffer());await (0,p.writeFile)(s,l),t.file_path=s}else t=await e.json();let a=["project_code","workflow_code","first_task_uid","file_name"].filter(e=>!t[e]||"string"==typeof t[e]&&""===t[e].trim());if(a.length>0)return d.NextResponse.json({error:`Missing required fields: ${a.join(", ")}`},{status:400});t.file_unique_identifier&&""!==t.file_unique_identifier.trim()||(t.file_unique_identifier=(0,l.O)(t.file_name)),t.file_path&&""!==t.file_path.trim()||(t.file_path=u.vP.DEFAULT_FILE_PATH),t.meta_data||(t.meta_data=u.yJ);let o=t.file_path,f=await (0,n.Kv)(t,o);return d.NextResponse.json(f,{status:200})}catch(e){return d.NextResponse.json({error:e.message||"Failed to register job batch file"},{status:e.status||500})}}let U=new s.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/register-job-batch-file/route",pathname:"/api/register-job-batch-file",filename:"route",bundlePath:"app/api/register-job-batch-file/route"},resolvedPagePath:"/Users/aritchellecal/Documents/personal/Content-Acquisition-Crawler/apps/content-acquisition/app/api/register-job-batch-file/route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:b,workUnitAsyncStorage:k,serverHooks:E}=U;function P(){return(0,o.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:k})}},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7093:()=>{},7365:()=>{},9021:e=>{"use strict";e.exports=require("fs")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[579,681,74],()=>r(4394));module.exports=i})();