(()=>{var e={};e.id=867,e.ids=[867],e.modules={408:()=>{},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7032:()=>{},7203:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>m,routeModule:()=>u,serverHooks:()=>l,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>p});var n={};r.r(n),r.d(n,{GET:()=>c});var s=r(8106),a=r(8819),o=r(2050),i=r(4235);async function c(e){try{let t,r,n=e.nextUrl.searchParams.get("url");if(!n)return i.NextResponse.json({error:"Missing URL parameter"},{status:400});if(n.includes("amazonaws.com"))try{if(t=decodeURIComponent(n),n.includes("X-Amz-Signature=")){let e=n.match(/X-Amz-Signature=([^&]+)/),r=t.match(/X-Amz-Signature=([^&]+)/);if(e&&r&&e[1]!==r[1]&&(t=t.replace(`X-Amz-Signature=${r[1]}`,`X-Amz-Signature=${e[1]}`)),n.includes("X-Amz-Security-Token=")){let e=n.match(/X-Amz-Security-Token=([^&]+)/),r=t.match(/X-Amz-Security-Token=([^&]+)/);e&&r&&e[1]!==r[1]&&(t=t.replace(`X-Amz-Security-Token=${r[1]}`,`X-Amz-Security-Token=${e[1]}`))}t.includes("IQoJb3JpZ")&&n.includes("IQoJb3JpZ")&&(t=n)}}catch{t=n}else t=decodeURIComponent(n);let s=t.split("?")[0];try{r=await fetch(t,{method:"GET",headers:{},credentials:"omit",cache:"no-store",redirect:"follow"})}catch(e){if(t.includes("amazonaws.com")&&t!==n)r=await fetch(n,{method:"GET",headers:{},credentials:"omit",cache:"no-store"});else throw e}if(!r.ok){let e=r.statusText;try{let t=await r.text();t&&(e=`${r.statusText} - ${t.substring(0,200)}`)}catch{}let t="Unable to retrieve the PDF file";return 403===r.status?t="Access denied - the S3 signed URL may have expired":400===r.status&&(t="The S3 signed URL may be expired or malformed",e.includes("InvalidToken")?t="Invalid security token in the S3 URL - the token may be malformed or expired":e.includes("UNSIGNED-PAYLOAD")?t="S3 signature validation failed - unsigned payload issue":e.includes("SignatureDoesNotMatch")&&(t="S3 signature does not match - the URL may be corrupted or expired")),i.NextResponse.json({error:`Failed to fetch PDF: ${r.status}`,details:e,url:s,message:t},{status:r.status})}let a=await r.arrayBuffer(),o="document.pdf";try{let e=r.headers.get("content-disposition");if(e){let t=e.match(/filename="?([^"]+)"?/i);t&&t[1]&&(o=t[1])}if("document.pdf"===o){let e=new URL(t).pathname.split("/"),r=e[e.length-1];r&&r.toLowerCase().includes(".pdf")&&(o=r)}}catch{}return new i.NextResponse(a,{headers:{"Content-Type":"application/pdf","Content-Length":a.byteLength.toString(),"Content-Disposition":`inline; filename="${encodeURIComponent(o)}"`,"Cache-Control":"no-cache, no-store",Pragma:"no-cache","X-Content-Type-Options":"nosniff","X-Frame-Options":"SAMEORIGIN","Access-Control-Allow-Origin":"*"}})}catch(t){let e=t instanceof Error?t.message:"Failed to proxy PDF file";return i.NextResponse.json({error:"Failed to proxy PDF file",details:e,timestamp:new Date().toISOString()},{status:500})}}let u=new s.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/pdf-proxy/route",pathname:"/api/pdf-proxy",filename:"route",bundlePath:"app/api/pdf-proxy/route"},resolvedPagePath:"/Users/aritchellecal/Documents/personal/Content-Acquisition-Crawler/apps/content-acquisition/app/api/pdf-proxy/route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:d,workUnitAsyncStorage:p,serverHooks:l}=u;function m(){return(0,o.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:p})}},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[191,744],()=>r(7203));module.exports=n})();